Comprehensive Summary of `anda_engine/src/memory.rs`

  This Rust module is a core component of the Anda engine, responsible for long-term memory management, 
  conversation history, and knowledge retrieval. It acts as the bridge between the AI's cognitive processes,
  the user's interaction history, and a persistent database backend.

  The module is built around a central struct, MemoryManagement, which orchestrates all interactions with the
  database and exposes functionalities to the rest of the system, particularly to the AI agent as tools.

  ---

  1. Core Components & Data Structures

  The module defines several key data structures that are persisted in the AndaDB database:

   * `Conversation`: This is the central data model. It represents a complete interaction session with a user
     and includes:
       * User identity (Principal), an optional thread ID (Xid).
       * A complete log of messages exchanged.
       * Input resources and output artifacts (files, data) generated during the session.
       * The conversation's status (e.g., Working, Completed, Failed).
       * LLM token usage statistics.
       * Timestamps and a period field for efficient time-based indexing and data lifecycle management.

   * `KIPLogs`: A logging structure for auditing. It records every execution of a KIP (Kip-instructed
     Protocol) command, capturing the user, the request, the response, and a link to the associated
     conversation. This is crucial for debugging and tracing the agent's actions.

   * `Resource`: (Defined in anda_core) Represents any data entity, such as a file, a URL, or binary data,
     that can be used or generated by the agent.

   * `MemoryManagement`: The primary struct that manages database collections for conversations, kip_logs, and
     resources.
       * `connect()`: This async function initializes the module by connecting to AndaDB, creating the
         necessary collections if they don't exist, and setting up database indexes. It intelligently uses:
           * B-Tree indexes for fast lookups on specific fields like user, thread, and period.
           * BM25 full-text search indexes on fields like messages and resources to enable powerful semantic
             search capabilities.

  ---

  2. Key Functionalities

  The MemoryManagement struct provides a comprehensive API for managing the agent's memory:

   * Conversation & Resource Management: Provides standard asynchronous CRUD (Create, Read, Update, Delete)
     operations for conversations and resources.
   * Search & Retrieval: Implements methods to list_conversations_by_user (with pagination) and
     search_conversations using the full-text search index.
   * Cognitive Nexus Integration: It connects to a CognitiveNexus (a knowledge graph component) to fetch rich,
     context-aware information, such as:
       * describe_system(): Retrieves the agent's core identity and capabilities.
       * describe_caller(): Fetches profile information about the current user.
   * Data Lifecycle: Includes a delete_expired_conversations function that efficiently removes old data based
     on the period index, ensuring the database remains performant.

  ---

  3. AI Agent Tooling

  A significant portion of the module is dedicated to exposing its functionalities as Tools that the AI agent
  (LLM) can call. This allows the agent to autonomously interact with its own memory.

   * `MemoryManagement` as a Tool: The struct itself implements the Tool trait to handle generic KIP requests.
     This serves as a powerful, low-level interface to the knowledge base.
   * `GetResourceContentTool`: A specific tool for the agent to read the content of a file or URL (Resource)
     by its ID.
   * `ListConversationsTool` & `SearchConversationsTool`: These tools allow the agent to look back at its
     previous interactions with a user, enabling it to maintain context over long periods.
   * `MemoryTool`: This is a high-level, multi-purpose tool that consolidates several key memory operations
     into a single, structured API for the agent. It uses a MemoryToolArgs enum to differentiate between
     actions like:
       * GetConversation / GetResource
       * StopConversation
       * ListPrevConversations / SearchConversations
       * ListKipLogs

  This consolidated tool design simplifies the interface for the LLM, making it easier and more reliable for
  the agent to use. Security is also a key consideration, as most of these tool functions include permission
  checks to ensure a user can only access their own data.